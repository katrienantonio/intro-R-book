<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Data science in insurance: an R intro</title>
  <meta name="description" content="An open-source and fully-reproducible electronic textbook introducing the use of R to actuarial students and professionals.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Data science in insurance: an R intro" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An open-source and fully-reproducible electronic textbook introducing the use of R to actuarial students and professionals." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Data science in insurance: an R intro" />
  
  <meta name="twitter:description" content="An open-source and fully-reproducible electronic textbook introducing the use of R to actuarial students and professionals." />
  

<meta name="author" content="Chester Ismay and Albert Y. Kim and Katrien Antonio">


<meta name="date" content="2018-09-20">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="probs.html">
<link rel="next" href="optimization.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#subsec:learning-goals"><i class="fa fa-check"></i><b>1.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#subsec:pipeline"><i class="fa fa-check"></i><b>1.2</b> Data/science pipeline</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#inspirations-and-references"><i class="fa fa-check"></i><b>1.3</b> Inspirations and references</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#sec:about-book"><i class="fa fa-check"></i><b>1.4</b> About this book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting started in R</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#some-history"><i class="fa fa-check"></i><b>2.1</b> Some history</a></li>
<li class="chapter" data-level="2.2" data-path="getting-started.html"><a href="getting-started.html#what-are-r-and-rstudio"><i class="fa fa-check"></i><b>2.2</b> What are R and RStudio?</a><ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started.html"><a href="getting-started.html#installing-r-and-rstudio"><i class="fa fa-check"></i><b>2.2.1</b> Installing R and RStudio</a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started.html"><a href="getting-started.html#using-r-via-rstudio"><i class="fa fa-check"></i><b>2.2.2</b> Using R via RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="getting-started.html"><a href="getting-started.html#code"><i class="fa fa-check"></i><b>2.3</b> How do I code in R?</a><ul>
<li class="chapter" data-level="2.3.1" data-path="getting-started.html"><a href="getting-started.html#tips-on-learning-to-code"><i class="fa fa-check"></i><b>2.3.1</b> Tips on learning to code</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="getting-started.html"><a href="getting-started.html#packages"><i class="fa fa-check"></i><b>2.4</b> What are R packages?</a><ul>
<li class="chapter" data-level="2.4.1" data-path="getting-started.html"><a href="getting-started.html#package-installation"><i class="fa fa-check"></i><b>2.4.1</b> Package installation</a></li>
<li class="chapter" data-level="2.4.2" data-path="getting-started.html"><a href="getting-started.html#package-loading"><i class="fa fa-check"></i><b>2.4.2</b> Package loading</a></li>
<li class="chapter" data-level="2.4.3" data-path="getting-started.html"><a href="getting-started.html#packages-on-cran"><i class="fa fa-check"></i><b>2.4.3</b> Packages on CRAN</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="getting-started.html"><a href="getting-started.html#conclusion"><i class="fa fa-check"></i><b>2.5</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="objects-data-types.html"><a href="objects-data-types.html"><i class="fa fa-check"></i><b>3</b> Objects and data types in R</a><ul>
<li class="chapter" data-level="3.1" data-path="objects-data-types.html"><a href="objects-data-types.html#how-it-works"><i class="fa fa-check"></i><b>3.1</b> How it works</a></li>
<li class="chapter" data-level="3.2" data-path="objects-data-types.html"><a href="objects-data-types.html#variables"><i class="fa fa-check"></i><b>3.2</b> Variables</a></li>
<li class="chapter" data-level="3.3" data-path="objects-data-types.html"><a href="objects-data-types.html#basic-data-types"><i class="fa fa-check"></i><b>3.3</b> Basic data types</a></li>
<li class="chapter" data-level="3.4" data-path="objects-data-types.html"><a href="objects-data-types.html#everything-is-an-object"><i class="fa fa-check"></i><b>3.4</b> Everything is an object</a></li>
<li class="chapter" data-level="3.5" data-path="objects-data-types.html"><a href="objects-data-types.html#vectors"><i class="fa fa-check"></i><b>3.5</b> Vectors</a></li>
<li class="chapter" data-level="3.6" data-path="objects-data-types.html"><a href="objects-data-types.html#matrices"><i class="fa fa-check"></i><b>3.6</b> Matrices</a></li>
<li class="chapter" data-level="3.7" data-path="objects-data-types.html"><a href="objects-data-types.html#data-frames"><i class="fa fa-check"></i><b>3.7</b> Data frames</a></li>
<li class="chapter" data-level="3.8" data-path="objects-data-types.html"><a href="objects-data-types.html#lists"><i class="fa fa-check"></i><b>3.8</b> Lists</a></li>
<li class="chapter" data-level="3.9" data-path="objects-data-types.html"><a href="objects-data-types.html#exercises"><i class="fa fa-check"></i><b>3.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="started-with-data.html"><a href="started-with-data.html"><i class="fa fa-check"></i><b>4</b> Getting started with data in R</a><ul>
<li class="chapter" data-level="4.1" data-path="started-with-data.html"><a href="started-with-data.html#importing-data"><i class="fa fa-check"></i><b>4.1</b> Importing data</a><ul>
<li class="chapter" data-level="4.1.1" data-path="started-with-data.html"><a href="started-with-data.html#importing-a-.csv-file-with-read.csv"><i class="fa fa-check"></i><b>4.1.1</b> Importing a .csv file with <code>read.csv()</code></a></li>
<li class="chapter" data-level="4.1.2" data-path="started-with-data.html"><a href="started-with-data.html#importing-a-.txt-file-the-danish-fire-insurance-data"><i class="fa fa-check"></i><b>4.1.2</b> Importing a .txt file: the Danish fire insurance data</a></li>
<li class="chapter" data-level="4.1.3" data-path="started-with-data.html"><a href="started-with-data.html#importing-a-.csv-file-policy-data"><i class="fa fa-check"></i><b>4.1.3</b> Importing a .csv file: policy data</a></li>
<li class="chapter" data-level="4.1.4" data-path="started-with-data.html"><a href="started-with-data.html#importing-a-.sas7bdat-file"><i class="fa fa-check"></i><b>4.1.4</b> Importing a .sas7bdat file</a></li>
<li class="chapter" data-level="4.1.5" data-path="started-with-data.html"><a href="started-with-data.html#importing-a-.xlsx-file"><i class="fa fa-check"></i><b>4.1.5</b> Importing a .xlsx file</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="started-with-data.html"><a href="started-with-data.html#basic-data-handling-steps"><i class="fa fa-check"></i><b>4.2</b> Basic data handling steps</a><ul>
<li class="chapter" data-level="4.2.1" data-path="started-with-data.html"><a href="started-with-data.html#subsetting"><i class="fa fa-check"></i><b>4.2.1</b> Subsetting</a></li>
<li class="chapter" data-level="4.2.2" data-path="started-with-data.html"><a href="started-with-data.html#find-minimum-or-maximum"><i class="fa fa-check"></i><b>4.2.2</b> Find minimum or maximum</a></li>
<li class="chapter" data-level="4.2.3" data-path="started-with-data.html"><a href="started-with-data.html#sorting"><i class="fa fa-check"></i><b>4.2.3</b> Sorting</a></li>
<li class="chapter" data-level="4.2.4" data-path="started-with-data.html"><a href="started-with-data.html#merging"><i class="fa fa-check"></i><b>4.2.4</b> Merging</a></li>
<li class="chapter" data-level="4.2.5" data-path="started-with-data.html"><a href="started-with-data.html#aggregate"><i class="fa fa-check"></i><b>4.2.5</b> Aggregate</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="started-with-data.html"><a href="started-with-data.html#exploratory-data-analysis-eda"><i class="fa fa-check"></i><b>4.3</b> Exploratory Data Analysis (EDA)</a><ul>
<li class="chapter" data-level="4.3.1" data-path="started-with-data.html"><a href="started-with-data.html#exploring-a-numerical-variable"><i class="fa fa-check"></i><b>4.3.1</b> Exploring a numerical variable</a></li>
<li class="chapter" data-level="4.3.2" data-path="started-with-data.html"><a href="started-with-data.html#exploring-a-categorical-or-factor-variable"><i class="fa fa-check"></i><b>4.3.2</b> Exploring a categorical (or: factor) variable</a></li>
<li class="chapter" data-level="4.3.3" data-path="started-with-data.html"><a href="started-with-data.html#exploring-two-categorical-or-factor-variables"><i class="fa fa-check"></i><b>4.3.3</b> Exploring two categorical (or: factor) variables</a></li>
<li class="chapter" data-level="4.3.4" data-path="started-with-data.html"><a href="started-with-data.html#exploring-one-numerical-and-one-categorical-variable"><i class="fa fa-check"></i><b>4.3.4</b> Exploring one numerical and one categorical variable</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="started-with-data.html"><a href="started-with-data.html#exercises-1"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-viz.html"><a href="data-viz.html"><i class="fa fa-check"></i><b>5</b> Visualizing data in R</a><ul>
<li class="chapter" data-level="5.1" data-path="data-viz.html"><a href="data-viz.html#basic-plot-instructions"><i class="fa fa-check"></i><b>5.1</b> Basic plot instructions</a><ul>
<li class="chapter" data-level="5.1.1" data-path="data-viz.html"><a href="data-viz.html#scatterplot"><i class="fa fa-check"></i><b>5.1.1</b> Scatterplot</a></li>
<li class="chapter" data-level="5.1.2" data-path="data-viz.html"><a href="data-viz.html#saving-the-scatterplot-as-a-pdf"><i class="fa fa-check"></i><b>5.1.2</b> Saving the scatterplot as a pdf</a></li>
<li class="chapter" data-level="5.1.3" data-path="data-viz.html"><a href="data-viz.html#the-curve-function"><i class="fa fa-check"></i><b>5.1.3</b> The <code>curve()</code> function</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-viz.html"><a href="data-viz.html#more-fancy-plots"><i class="fa fa-check"></i><b>5.2</b> More fancy plots</a><ul>
<li class="chapter" data-level="5.2.1" data-path="data-viz.html"><a href="data-viz.html#creating-graphics-with-ggplot2"><i class="fa fa-check"></i><b>5.2.1</b> Creating graphics with <code>ggplot2</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="data-viz.html"><a href="data-viz.html#fancy-correlation-plots"><i class="fa fa-check"></i><b>5.2.2</b> Fancy correlation plots</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-viz.html"><a href="data-viz.html#exercises-2"><i class="fa fa-check"></i><b>5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>6</b> Data wrangling in R</a><ul>
<li class="chapter" data-level="6.1" data-path="data-wrangling.html"><a href="data-wrangling.html#ideas-from-the-tidyverse"><i class="fa fa-check"></i><b>6.1</b> Ideas from the <code>tidyverse</code></a><ul>
<li class="chapter" data-level="6.1.1" data-path="data-wrangling.html"><a href="data-wrangling.html#a-tibble-instead-of-a-data.frame"><i class="fa fa-check"></i><b>6.1.1</b> A <code>tibble</code> instead of a <code>data.frame</code></a></li>
<li class="chapter" data-level="6.1.2" data-path="data-wrangling.html"><a href="data-wrangling.html#pipes-in-r"><i class="fa fa-check"></i><b>6.1.2</b> Pipes in R</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-wrangling.html"><a href="data-wrangling.html#filter-observations-using-filter"><i class="fa fa-check"></i><b>6.1.3</b> Filter observations using <code>filter</code></a></li>
<li class="chapter" data-level="6.1.4" data-path="data-wrangling.html"><a href="data-wrangling.html#summarize-variables-using-summarize"><i class="fa fa-check"></i><b>6.1.4</b> Summarize variables using <code>summarize</code></a></li>
<li class="chapter" data-level="6.1.5" data-path="data-wrangling.html"><a href="data-wrangling.html#summarize-based-on-groupings-of-another-variable"><i class="fa fa-check"></i><b>6.1.5</b> Summarize based on groupings of another variable</a></li>
<li class="chapter" data-level="6.1.6" data-path="data-wrangling.html"><a href="data-wrangling.html#joining-tibbles"><i class="fa fa-check"></i><b>6.1.6</b> Joining tibbles</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-wrangling.html"><a href="data-wrangling.html#data-science-the-data.table-way"><i class="fa fa-check"></i><b>6.2</b> Data science the <code>data.table</code> way</a><ul>
<li class="chapter" data-level="6.2.1" data-path="data-wrangling.html"><a href="data-wrangling.html#speed-junkies-love-data.table"><i class="fa fa-check"></i><b>6.2.1</b> Speed junkies love <code>data.table</code></a></li>
<li class="chapter" data-level="6.2.2" data-path="data-wrangling.html"><a href="data-wrangling.html#what-is-a-data.table"><i class="fa fa-check"></i><b>6.2.2</b> What is a <code>data.table</code>?</a></li>
<li class="chapter" data-level="6.2.3" data-path="data-wrangling.html"><a href="data-wrangling.html#identify-keys"><i class="fa fa-check"></i><b>6.2.3</b> Identify keys</a></li>
<li class="chapter" data-level="6.2.4" data-path="data-wrangling.html"><a href="data-wrangling.html#alternative-and-faster-ways-to-aggregate"><i class="fa fa-check"></i><b>6.2.4</b> Alternative and faster ways to <code>aggregate</code></a></li>
<li class="chapter" data-level="6.2.5" data-path="data-wrangling.html"><a href="data-wrangling.html#joining-data.tables"><i class="fa fa-check"></i><b>6.2.5</b> Joining <code>data.tables</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="data-wrangling.html"><a href="data-wrangling.html#exercises-3"><i class="fa fa-check"></i><b>6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="probs.html"><a href="probs.html"><i class="fa fa-check"></i><b>7</b> Working with probability distributions in R</a><ul>
<li class="chapter" data-level="7.1" data-path="probs.html"><a href="probs.html#discrete-distributions"><i class="fa fa-check"></i><b>7.1</b> Discrete distributions</a><ul>
<li class="chapter" data-level="7.1.1" data-path="probs.html"><a href="probs.html#the-binomial-distribution"><i class="fa fa-check"></i><b>7.1.1</b> The binomial distribution</a></li>
<li class="chapter" data-level="7.1.2" data-path="probs.html"><a href="probs.html#the-poisson-distribution"><i class="fa fa-check"></i><b>7.1.2</b> The Poisson distribution</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="probs.html"><a href="probs.html#continuous-distributions"><i class="fa fa-check"></i><b>7.2</b> Continuous distributions</a><ul>
<li class="chapter" data-level="7.2.1" data-path="probs.html"><a href="probs.html#the-normal-distribution"><i class="fa fa-check"></i><b>7.2.1</b> The normal distribution</a></li>
<li class="chapter" data-level="7.2.2" data-path="probs.html"><a href="probs.html#the-gamma-distribution"><i class="fa fa-check"></i><b>7.2.2</b> The gamma distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>8</b> Writing functions in R</a><ul>
<li class="chapter" data-level="8.1" data-path="functions.html"><a href="functions.html#conditionals-and-control-flow"><i class="fa fa-check"></i><b>8.1</b> Conditionals and control flow</a></li>
<li class="chapter" data-level="8.2" data-path="functions.html"><a href="functions.html#logical-operators"><i class="fa fa-check"></i><b>8.2</b> Logical operators</a></li>
<li class="chapter" data-level="8.3" data-path="functions.html"><a href="functions.html#loops"><i class="fa fa-check"></i><b>8.3</b> Loops</a><ul>
<li class="chapter" data-level="8.3.1" data-path="functions.html"><a href="functions.html#the-while-loop"><i class="fa fa-check"></i><b>8.3.1</b> The while loop</a></li>
<li class="chapter" data-level="8.3.2" data-path="functions.html"><a href="functions.html#the-for-loop"><i class="fa fa-check"></i><b>8.3.2</b> The for loop</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="functions.html"><a href="functions.html#functions-in-r"><i class="fa fa-check"></i><b>8.4</b> Functions in R</a><ul>
<li class="chapter" data-level="8.4.1" data-path="functions.html"><a href="functions.html#use-a-function"><i class="fa fa-check"></i><b>8.4.1</b> Use a function</a></li>
<li class="chapter" data-level="8.4.2" data-path="functions.html"><a href="functions.html#write-your-own-function"><i class="fa fa-check"></i><b>8.4.2</b> Write your own function</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="functions.html"><a href="functions.html#the-apply-family"><i class="fa fa-check"></i><b>8.5</b> The apply family</a></li>
<li class="chapter" data-level="8.6" data-path="functions.html"><a href="functions.html#exercises-4"><i class="fa fa-check"></i><b>8.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>9</b> Optimization in R</a><ul>
<li class="chapter" data-level="9.1" data-path="optimization.html"><a href="optimization.html#find-the-root-of-a-function"><i class="fa fa-check"></i><b>9.1</b> Find the root of a function</a></li>
<li class="chapter" data-level="9.2" data-path="optimization.html"><a href="optimization.html#find-the-maximum-of-a-function"><i class="fa fa-check"></i><b>9.2</b> Find the maximum of a function</a></li>
<li class="chapter" data-level="9.3" data-path="optimization.html"><a href="optimization.html#do-maximum-likelihood-estimation-mle"><i class="fa fa-check"></i><b>9.3</b> Do Maximum Likelihood Estimation (MLE)</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="lms.html"><a href="lms.html"><i class="fa fa-check"></i><b>10</b> Linear Regression Models in R</a><ul>
<li class="chapter" data-level="10.1" data-path="lms.html"><a href="lms.html#a-simple-linear-regression-model"><i class="fa fa-check"></i><b>10.1</b> A simple linear regression model</a></li>
<li class="chapter" data-level="10.2" data-path="lms.html"><a href="lms.html#a-multiple-linear-regression-model"><i class="fa fa-check"></i><b>10.2</b> A multiple linear regression model</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="glms.html"><a href="glms.html"><i class="fa fa-check"></i><b>11</b> Generalized Linear Models in R</a><ul>
<li class="chapter" data-level="11.1" data-path="glms.html"><a href="glms.html#modelling-count-data-with-poisson-regression-models"><i class="fa fa-check"></i><b>11.1</b> Modelling count data with Poisson regression models</a><ul>
<li class="chapter" data-level="11.1.1" data-path="glms.html"><a href="glms.html#a-first-data-set"><i class="fa fa-check"></i><b>11.1.1</b> A first data set</a></li>
<li class="chapter" data-level="11.1.2" data-path="glms.html"><a href="glms.html#fit-a-poisson-glm"><i class="fa fa-check"></i><b>11.1.2</b> Fit a Poisson GLM</a></li>
<li class="chapter" data-level="11.1.3" data-path="glms.html"><a href="glms.html#the-use-of-exposure"><i class="fa fa-check"></i><b>11.1.3</b> The use of exposure</a></li>
<li class="chapter" data-level="11.1.4" data-path="glms.html"><a href="glms.html#analysis-of-deviance-for-glms"><i class="fa fa-check"></i><b>11.1.4</b> Analysis of deviance for GLMs</a></li>
<li class="chapter" data-level="11.1.5" data-path="glms.html"><a href="glms.html#an-example"><i class="fa fa-check"></i><b>11.1.5</b> An example</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="glms.html"><a href="glms.html#overdispersed-poisson-regression"><i class="fa fa-check"></i><b>11.2</b> Overdispersed Poisson regression</a></li>
<li class="chapter" data-level="11.3" data-path="glms.html"><a href="glms.html#negative-binomial-regression"><i class="fa fa-check"></i><b>11.3</b> Negative Binomial regression</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="biblio.html"><a href="biblio.html"><i class="fa fa-check"></i><b>12</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data science in insurance: an R intro</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1">
<h1><span class="header-section-number">8</span> Writing functions in R</h1>
<div id="conditionals-and-control-flow" class="section level2">
<h2><span class="header-section-number">8.1</span> Conditionals and control flow</h2>
<p>In this chapter you’ll learn about relational operators to see how R objects compare and logical operators to combine logicals. Next, you’ll use this knowledge to build conditional statements. [Quote from DataCamp’s `Intermediate R’ course]</p>
<p>Make sure not to mix up <code>==</code> and <code>=</code>, where the latter is used for assignment and the former checks equality.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">3</span> <span class="op">==</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">&quot;intermediate&quot;</span> <span class="op">!=</span><span class="st"> &quot;r&quot;</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="ot">TRUE</span> <span class="op">!=</span><span class="st"> </span><span class="ot">FALSE</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">&quot;Rchitect&quot;</span> <span class="op">!=</span><span class="st"> &quot;rchitect&quot;</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>Now you’ll focus on inequalities.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">4</span></code></pre></div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">&quot;dog&quot;</span> <span class="op">&lt;</span><span class="st"> &quot;Cats&quot;</span></code></pre></div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="ot">TRUE</span> <span class="op">&lt;=</span><span class="st"> </span><span class="ot">FALSE</span></code></pre></div>
<pre><code>[1] FALSE</code></pre>
<p>For string comparison, R determines the greater than relationship based on alphabetical order. Also, keep in mind that <code>TRUE</code> corresponds to 1 in R, and <code>FALSE</code> coerces to 0 behind the scenes.</p>
<p>R’s relational operators also work on vectors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">katrien &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">19</span>, <span class="dv">22</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>)
katrien <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span></code></pre></div>
<pre><code>[1]  TRUE  TRUE FALSE FALSE  TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">jan &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">34</span>, <span class="dv">55</span>, <span class="dv">76</span>, <span class="dv">25</span>, <span class="dv">4</span>)
jan <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span></code></pre></div>
<pre><code>[1] FALSE FALSE FALSE  TRUE  TRUE</code></pre>
<hr />
</div>
<div id="logical-operators" class="section level2">
<h2><span class="header-section-number">8.2</span> Logical operators</h2>
<p>Check the following statements</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="ot">TRUE</span> <span class="op">&amp;</span><span class="st"> </span><span class="ot">TRUE</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="ot">FALSE</span> <span class="op">|</span><span class="st"> </span><span class="ot">TRUE</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">5</span> <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span><span class="dv">2</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">3</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">4</span> <span class="op">|</span><span class="st"> </span><span class="dv">7</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">6</span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>The logical operators applied to vectors</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">katrien <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>jan <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span></code></pre></div>
<pre><code>[1] FALSE FALSE FALSE FALSE  TRUE</code></pre>
<p>The <code>!</code> operator reverses the result of a logical value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">!</span><span class="ot">TRUE</span></code></pre></div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">!</span>(<span class="dv">5</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>)</code></pre></div>
<pre><code>[1] FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">!!</span><span class="ot">FALSE</span></code></pre></div>
<pre><code>[1] FALSE</code></pre>
<p>Time to check out the <code>if</code> statement in R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">num_attendees &lt;-<span class="st"> </span><span class="dv">30</span>
<span class="cf">if</span> (num_attendees <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>) {
  <span class="kw">print</span>(<span class="st">&quot;You&#39;re popular!&quot;</span>)
}</code></pre></div>
<pre><code>[1] &quot;You&#39;re popular!&quot;</code></pre>
<p>In the <code>if</code> <code>else</code> statement it is important that the else keyword comes on the same line as the closing bracket of the if part!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">num_attendees &lt;-<span class="st"> </span><span class="dv">5</span>
<span class="cf">if</span> (num_attendees <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>) {
  <span class="kw">print</span>(<span class="st">&quot;You&#39;re popular!&quot;</span>)
}<span class="cf">else</span>{
  <span class="kw">print</span>(<span class="st">&quot;You are not so popular!&quot;</span>)
}</code></pre></div>
<pre><code>[1] &quot;You are not so popular!&quot;</code></pre>
<p>Let’s add a control statement</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">num_attendees &lt;-<span class="st"> </span><span class="dv">5</span>
num_questions &lt;-<span class="st"> </span><span class="dv">3</span>
<span class="cf">if</span> (num_attendees <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>num_questions <span class="op">&lt;=</span><span class="dv">2</span>) {
  <span class="kw">print</span>(<span class="st">&quot;Easy workshop&quot;</span>)
}<span class="cf">else</span>{
  <span class="kw">print</span>(<span class="st">&quot;Work to do!&quot;</span>)
}</code></pre></div>
<pre><code>[1] &quot;Work to do!&quot;</code></pre>
<hr />
</div>
<div id="loops" class="section level2">
<h2><span class="header-section-number">8.3</span> Loops</h2>
<div id="the-while-loop" class="section level3">
<h3><span class="header-section-number">8.3.1</span> The while loop</h3>
<p>You’ll start with a <code>while</code> loop.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">todo &lt;-<span class="st"> </span><span class="dv">64</span>

<span class="cf">while</span> (todo <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span>) {
  <span class="kw">print</span>(<span class="st">&quot;Work harder&quot;</span>)
  todo &lt;-<span class="st"> </span>todo <span class="op">-</span><span class="st"> </span><span class="dv">7</span>
}</code></pre></div>
<pre><code>[1] &quot;Work harder&quot;
[1] &quot;Work harder&quot;
[1] &quot;Work harder&quot;
[1] &quot;Work harder&quot;
[1] &quot;Work harder&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">todo</code></pre></div>
<pre><code>[1] 29</code></pre>
<p>The example below puts many things together (taken from DataCamp’s `Intermediate R’ course).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="dv">1</span>

<span class="cf">while</span> (i <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>) {
  <span class="kw">print</span>(<span class="dv">3</span> <span class="op">*</span><span class="st"> </span>i)
  <span class="cf">if</span> ( (<span class="dv">3</span> <span class="op">*</span><span class="st"> </span>i) <span class="op">%%</span><span class="st"> </span><span class="dv">8</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {
    <span class="cf">break</span>
  }
  i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
}</code></pre></div>
<pre><code>[1] 3
[1] 6
[1] 9
[1] 12
[1] 15
[1] 18
[1] 21
[1] 24</code></pre>
</div>
<div id="the-for-loop" class="section level3">
<h3><span class="header-section-number">8.3.2</span> The for loop</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">primes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">13</span>)

<span class="co"># loop version 1</span>
<span class="cf">for</span> (p <span class="cf">in</span> primes) {
  <span class="kw">print</span>(p)
}</code></pre></div>
<pre><code>[1] 2
[1] 3
[1] 5
[1] 7
[1] 11
[1] 13</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># loop version 2</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(primes)) {
  <span class="kw">print</span>(primes[i])
}</code></pre></div>
<pre><code>[1] 2
[1] 3
[1] 5
[1] 7
[1] 11
[1] 13</code></pre>
<p>A loop to count the number of r’s in a given character string.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rquote &lt;-<span class="st"> &quot;r&#39;s internals are irrefutably intriguing&quot;</span>
chars &lt;-<span class="st"> </span><span class="kw">strsplit</span>(rquote, <span class="dt">split =</span> <span class="st">&quot;&quot;</span>)[[<span class="dv">1</span>]]
chars</code></pre></div>
<pre><code> [1] &quot;r&quot; &quot;&#39;&quot; &quot;s&quot; &quot; &quot; &quot;i&quot; &quot;n&quot; &quot;t&quot; &quot;e&quot; &quot;r&quot; &quot;n&quot; &quot;a&quot; &quot;l&quot; &quot;s&quot; &quot; &quot; &quot;a&quot; &quot;r&quot; &quot;e&quot; &quot; &quot; &quot;i&quot;
[20] &quot;r&quot; &quot;r&quot; &quot;e&quot; &quot;f&quot; &quot;u&quot; &quot;t&quot; &quot;a&quot; &quot;b&quot; &quot;l&quot; &quot;y&quot; &quot; &quot; &quot;i&quot; &quot;n&quot; &quot;t&quot; &quot;r&quot; &quot;i&quot; &quot;g&quot; &quot;u&quot; &quot;i&quot;
[39] &quot;n&quot; &quot;g&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Initialize rcount</span>
rcount &lt;-<span class="st"> </span><span class="dv">0</span>

<span class="co"># Finish the for loop</span>
<span class="cf">for</span> (char <span class="cf">in</span> chars) {
  <span class="cf">if</span> (char <span class="op">==</span><span class="st"> &quot;r&quot;</span>) {
    rcount &lt;-<span class="st"> </span>rcount <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
  }
  <span class="cf">if</span> (char <span class="op">==</span><span class="st"> &quot;u&quot;</span>) {
    <span class="cf">break</span>
  }
}

<span class="co"># Print out rcount</span>
rcount</code></pre></div>
<pre><code>[1] 5</code></pre>
<hr />
</div>
</div>
<div id="functions-in-r" class="section level2">
<h2><span class="header-section-number">8.4</span> Functions in R</h2>
<div id="use-a-function" class="section level3">
<h3><span class="header-section-number">8.4.1</span> Use a function</h3>
<p>What is a function? Let’s start from a classic one, the `mean()’.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">? mean
<span class="kw">help</span>(mean)
<span class="kw">args</span>(mean)</code></pre></div>
<pre><code>function (x, ...) 
NULL</code></pre>
<p>In <code>mean(x, trim = 0, na.rm = FALSE, ...)</code> <code>x</code> is required; if you do not specify it, R will throw an error. <code>trim</code> and <code>na.rm</code> are optional arguments: they have a default value which is used if the arguments are not explicitly specified. [Quote from DataCamp’s ‘Intermediate R’ course.]</p>
<p>You will now use the <code>mean</code> function as follows</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">katrien &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">9</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="ot">NA</span>)

<span class="kw">mean</span>(katrien)</code></pre></div>
<pre><code>[1] NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(katrien, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>[1] 6.25</code></pre>
<p>Functions return objects that can be used elsewhere. As such, you can use a function within function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">katrien &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">9</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="ot">NA</span>)
jan &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="ot">NA</span>, <span class="dv">5</span>)
katrien <span class="op">-</span><span class="st"> </span>jan</code></pre></div>
<pre><code>[1]  2  6  4 NA NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">abs</span>(katrien <span class="op">-</span><span class="st"> </span>jan), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>[1] 4</code></pre>
</div>
<div id="write-your-own-function" class="section level3">
<h3><span class="header-section-number">8.4.2</span> Write your own function</h3>
<p>Creating a function in R is basically the assignment of a function object to a variable. That’s why you will use the assignment operator <code>-&gt;</code>. Here is the basic syntax for writing a function in R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="kw">sqrt</span>(x)
}

<span class="co"># Use the function</span>
<span class="kw">my_sqrt</span>(<span class="dv">12</span>)</code></pre></div>
<pre><code>[1] 3.4641</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">my_sqrt</span>(<span class="dv">16</span>)</code></pre></div>
<pre><code>[1] 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sum_abs &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {
  <span class="kw">abs</span>(x) <span class="op">+</span><span class="st"> </span><span class="kw">abs</span>(y)
}

<span class="co"># Use the function</span>
<span class="kw">sum_abs</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">3</span>)</code></pre></div>
<pre><code>[1] 5</code></pre>
<p>You can define default argument values in your own R functions as well. Here you see an example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_sqrt &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">print_info =</span> <span class="ot">TRUE</span>) {
  y &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x)
  <span class="cf">if</span> (print_info) {
    <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;sqrt&quot;</span>, x, <span class="st">&quot;equals&quot;</span>, y))
  }
  <span class="kw">return</span>(y)
}

<span class="co"># some calls of the function</span>
<span class="kw">my_sqrt</span>(<span class="dv">16</span>)</code></pre></div>
<pre><code>[1] &quot;sqrt 16 equals 4&quot;</code></pre>
<pre><code>[1] 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">my_sqrt</span>(<span class="dv">16</span>, <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>[1] 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">my_sqrt</span>(<span class="dv">16</span>, <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>[1] &quot;sqrt 16 equals 4&quot;</code></pre>
<pre><code>[1] 4</code></pre>
<p>R works in a vectorized way. Check this by calling the function <code>my_sqrt</code> on an input vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">16</span>, <span class="dv">25</span>, <span class="dv">36</span>)
<span class="kw">my_sqrt</span>(v)</code></pre></div>
<pre><code>[1] &quot;sqrt 16 equals 4&quot; &quot;sqrt 25 equals 5&quot; &quot;sqrt 36 equals 6&quot;</code></pre>
<pre><code>[1] 4 5 6</code></pre>
<hr />
</div>
</div>
<div id="the-apply-family" class="section level2">
<h2><span class="header-section-number">8.5</span> The apply family</h2>
<p>Whenever you’re using a for loop, you might want to revise your code and see whether you can a member of the <code>apply</code> family instead. [Quote from DataCamp’s `Intermediate R’ course]</p>
<p><code>apply</code> is the first member of this family.</p>
<ul>
<li>It must be applied on a matrix.</li>
<li>It takes the following arguments:</li>
<li>first argument: matrix you are working with</li>
<li>second argument: margin to apply the function over (1 for rows and 2 for columns)</li>
<li>third argument: function you want to apply.</li>
</ul>
<p>Here you see how it works.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_matrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="dt">nrow =</span> <span class="dv">3</span>)
<span class="co"># sum the rows</span>
<span class="kw">apply</span>(my_matrix, <span class="dv">1</span>, sum)</code></pre></div>
<pre><code>[1] 12 15 18</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sum the columns</span>
<span class="kw">apply</span>(my_matrix, <span class="dv">2</span>, sum)</code></pre></div>
<pre><code>[1]  6 15 24</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># impute a missing observation in my_matrix</span>
my_matrix[<span class="dv">2</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
<span class="kw">apply</span>(my_matrix, <span class="dv">1</span>, sum)</code></pre></div>
<pre><code>[1] 12 NA 18</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">apply</span>(my_matrix, <span class="dv">1</span>, sum, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>[1] 12 13 18</code></pre>
<p>You already encountered a first illustration of <code>tapply</code> in Chapter <a href="started-with-data.html#started-with-data">4</a>. The <code>tapply</code> function is useful when we need to break up a vector into groups defined by some classifying factor, compute a function on the subsets, and return the results in a convenient form.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5500</span>, <span class="dv">3500</span>, <span class="dv">6500</span>, <span class="dv">7500</span>)
gender &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>)
region &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;North&quot;</span>, <span class="st">&quot;South&quot;</span>, <span class="st">&quot;North&quot;</span>, <span class="st">&quot;South&quot;</span>)
salary &lt;-<span class="st"> </span><span class="kw">data.frame</span>(wages, gender, region)
<span class="kw">tapply</span>(salary<span class="op">$</span>wages, salary<span class="op">$</span>gender, mean)</code></pre></div>
<pre><code>   F    M 
4500 7000 </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tapply</span>(salary<span class="op">$</span>wages, <span class="kw">list</span>(salary<span class="op">$</span>gender, salary<span class="op">$</span>region), mean)</code></pre></div>
<pre><code>  North South
F  5500  3500
M  6500  7500</code></pre>
<p><code>lapply</code> works by applying a function to each element of a list and returning the results as a list. To return the result of <code>lapply</code> as a vector instead of a list, use <code>sapply</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">A =</span> <span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="dv">3</span>), <span class="dt">B =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">C =</span> <span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">2</span>), <span class="dt">D =</span> <span class="dv">2</span>)
my_list</code></pre></div>
<pre><code>$A
     [,1] [,2] [,3]
[1,]    1    4    7
[2,]    2    5    8
[3,]    3    6    9

$B
[1] 1 2 3 4 5

$C
     [,1] [,2]
[1,]    1    3
[2,]    2    4

$D
[1] 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lapply</span>(my_list, sum)</code></pre></div>
<pre><code>$A
[1] 45

$B
[1] 15

$C
[1] 10

$D
[1] 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(my_list, sum)</code></pre></div>
<pre><code> A  B  C  D 
45 15 10  2 </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Katrien&quot;</span>, <span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Leen&quot;</span>)
<span class="kw">lapply</span>(my_names, nchar)</code></pre></div>
<pre><code>[[1]]
[1] 7

[[2]]
[1] 3

[[3]]
[1] 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(my_names, nchar)</code></pre></div>
<pre><code>Katrien     Jan    Leen 
      7       3       4 </code></pre>
<p><code>mapply</code> applies a function to each element of multiple lists.</p>
<hr />
</div>
<div id="exercises-4" class="section level2">
<h2><span class="header-section-number">8.6</span> Exercises</h2>
<div class="learncheck">
<p>
<strong><em>Learning check</em></strong>
</p>
</div>
<ol style="list-style-type: decimal">
<li>The function <code>var</code> in R calculates the unbiased variance estimator, given a random sample of data. Write a function <code>variance</code> which returns the biased or unbiased estimate of the variance, depending on the value of the argument <code>bias</code> which can be <code>TRUE</code> or <code>FALSE</code>. By default the function <code>variance</code> should produce the same result as <code>var</code>. Formulas: unbiased = <span class="math inline">\(\frac{1}{n-1}\sum_i (x_i-\bar{x})^2\)</span> and biased = <span class="math inline">\(\frac{1}{n}\sum_i(x_i-\bar{x})^2\)</span> where <span class="math inline">\(\bar{x}=\frac{1}{n} \sum_i x_i\)</span>.</li>
</ol>
<div class="learncheck">

</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="probs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="optimization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
